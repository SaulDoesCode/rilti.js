(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.rilti={})})(this,function(a){"use strict";const b=Symbol("Proxy Node"),c=Symbol("Component"),d=a=>i(a)&&!0===a[b],e=a=>a!==void 0&&a[c]!==void 0,f=Array.isArray,g=a=>null==a,h=a=>null!=a,i=a=>a instanceof Function,j=a=>null!=a&&a.constructor===Object,k=a=>"string"==typeof a,l=a=>"number"==typeof a&&!isNaN(a),m=a=>l(a)&&0==a%1,n=a=>null!=a&&(f(a)||!(a instanceof Function||a instanceof Node)&&0==a.length%1),o=(a,b=!0)=>a instanceof NodeList||b&&w(a,p),p=a=>a instanceof Node,q=a=>(a=typeof a,"string"===a||"number"===a||"boolean"===a),r=a=>a instanceof Element,s=a=>"object"==typeof a&&i(a.then),t=(a,b=document)=>o(a)?Array.from(a).every(a=>t(a)):b===a||!!(16&b.compareDocumentPosition(a)),u=(a,b)=>(d(a)&&(a=a()),a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||!!b&&a instanceof Element&&"true"===a.getAttribute("contenteditable")),v=a=>a instanceof Node||d(a)||q(a)||w(a,v),w=(a,b)=>{if(n(a)){const c=b instanceof Function;for(let d=0;d<a.length;d++)if(c?!b(a[d]):a[d]!==b)return!1;return!0}return!1},x=(a,b=a.length,...c)=>b<=c.length?a(...c):x.bind(void 0,a,b,...c),y=(a,b=[],c=!0)=>{if(c&&!f(a))return[a];for(let d=0;d<a.length;d++)f(a[d])?y(a[d],b):b.push(a[d]);return b};a.runAsync=(a,...b)=>window.requestIdleCallback(a.bind(void 0,...b)),window.requestIdleCallback||(a.runAsync=(a,...b)=>setTimeout(a,0,...b));const z=function(){document.body||"complete"===document.readyState?a.runAsync.apply(void 0,arguments):window.addEventListener("DOMContentLoaded",()=>a.runAsync.apply(void 0,arguments),{once:!0})},A=(a,b=document)=>p(a)?a:A(b).querySelector(a),B=(a,b)=>new Promise((c,d)=>{const e=()=>{const e=A(a,b);null==e?d(new Error("queryAsync: couldn't find "+a)):c(e)};document.body?e():z(e)}),C=(a,b=document)=>Array.from(A(b).querySelectorAll(a)),D=(a,b,c=document)=>(i(b)||([b,c]=[c,document]),E(C(a,c),b)),E=(a,b)=>{if(h(a))if(j(a))for(const c in a)b(a[c],c,a);else if(a.length){const c=a.length;for(let d=0;d!==c;)b(a[d],d++,a)}else if(a.forEach)a.forEach(b);else if(m(a))for(let c=0;c<a;)b(c++,a);return a},F=(a,b)=>new Proxy(a,{get:!0===b?(a,b)=>b in a?Reflect.get(a,b):a.bind(void 0,b):(a,b)=>a.bind(void 0,b)}),G=a=>(b,c)=>a[null==c?"has":c?"add":"delete"](b),H=(a,b,c)=>(Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c)),a),I=(a,b)=>{if(f(a)&&f(b))for(let c=0;c<b.length;c++){const d=b[c];a.includes(d)||a.push(d)}else if(I.able(a)&&I.able(b))for(const c in b)if(c in a){const d=a[c],e=b[c];I.able(d)&&I.able(e)?I(d,e):null!=e&&H(a,b,c)}else H(a,b,c);return a};I.able=a=>null!=a&&(f(a)||!(q(a)||s(a)));const J=new Map,K=(a=Object.create(null),b)=>{const c=new Map;c.add=(a,b)=>{c.has(a)||c.set(a,new Set),c.get(a).add(b)},c.remove=(a,b)=>{c.has(a)&&(b?c.get(a).delete(b):c.each(a,a=>a.revoke()),!c.get(a).size&&c.delete(a))},c.each=(a,b)=>{c.has(a)&&c.get(a).forEach(b)};const d=(e,f,h,i)=>u(f,!0)?d.input(e,f,h):(i&&(f=i(f,g)),c.add(e,f=f.bind(b)),e in a&&f(a[e],void 0,g,b),f.revoke=()=>{h&&h(g),c.remove(e,f)},f);d.text=(b,c)=>{const e=new Text,f=a=>{e.textContent=a};return d(b,f,()=>{c&&c(g),da.remove(e)}),b in a&&f(a[b]),e},d.input=(b,c,e)=>{if(k(c)&&(c=A(c)),null==c)throw new Error(`state.bind.${b}: invalid/nil input element)`);c instanceof Node&&(c=L(c));let f=!0;const h=u(c),i=a=>{f&&(h?c.value=a:c.innerText=a)},j=c.on.input(()=>{f=!1,g[b]=c.value,f=!0});return d(b,i,()=>{e&&e(g),j.off()}),b in a&&i(a[b]),c};const e=b=>(c.remove(b),delete a[b]),g=new Proxy((b,...c)=>{if(b.constructor===Object){const d=!0===c[0];for(const c in b)(d?a:g)[c]=b[c]}else if("string"==typeof b)g[b]=c[0];else{if(f(b))return y(c.reduce((a,c,e)=>[a,d.text(c),b[e+1]],b[0]).filter(a=>!k(a)||a.length));if(u(b,!0)&&"string"==typeof c[0])return d.input(b,...c)}return g},{get:(b,e)=>"bind"===e?d:"binds"===e?c:"$"===e[0]?d.bind(null,e.substr(1)):Reflect.get(a,e),set(d,f,h){if(null==h)e(f);else{const d=a[f];h!==d&&(a[f]=h,c.each(f,a=>a(h,d,g,b)))}return!0},deleteProperty:(a,b)=>e(b)});return g},L=a=>{if(d(a))return a;if("string"==typeof a&&(a=A(a),!a))throw new Error("no selector match");if(J.has(a))return J.get(a);if(!(a instanceof Node))throw new TypeError(`$ needs a Node: ${a}`);const c=new Proxy((b,c)=>(da.class(a,b,c),p),{get:(b,c)=>a.classList.contains(c),set:(a,b,c)=>a(b,c),deleteProperty:(b,c)=>!!a.classList.remove(c)});if(r(a))var e=a.getAttribute.bind(a),f=a.hasAttribute.bind(a),g=da.removeAttribute.bind(void 0,a),h=new Proxy((b,c)=>{const d=da.attr(a,b,c);return d===a?p:d},{get:(a,b)=>"has"===b?f:"remove"===b?g:e(b),set(a,b,c){return"remove"===b?g(c):a(b,c),!0},deleteProperty:(b,c)=>da.removeAttribute(a,c)});const j=u(a),l=j?"value":"textContent",m=j?"value":3===a.nodeType?l:"innerHTML",n=F(Q(!0,a),!1),o=F(Q(!1,a),!1),p=new Proxy(Object.assign(b=>(b instanceof Function&&!d(b)&&b.call(a,p,a),a),{class:c,attr:h,on:o,once:n,emit:$.bind(void 0,a),render:ca.bind(void 0,a)}),{get(c,e){if(Reflect.has(c,e))return Reflect.get(c,e);if("state"===e)return c[e]||(c[e]=K(Object.create(null),p));if("txt"===e)return a[l];if("html"===e)return a[m];if("mounted"===e)return t(a);if("children"===e)return Array.from(a.children);if("$children"===e)return Array.prototype.map.call(a.children,L);if("parent"===e&&a.parentNode)return L(a.parentNode);if(e in da)return(...b)=>{const c=da[e](a,...b);return c===a||c===p?p:c};if(e===b)return!0;const f=a[e];return i(f)&&!d(f)?f.bind(a):f},set(b,d,e){return"class"===d?c(a,e):"attr"===d?h(a,e):"css"===d?da.css(a,e):"state"===d?(b[d]||p[d])(e):"txt"===d?a[l]=e:"html"===d||"children"===d?k(e)?a[m]=e:(a[l]="",_(aa(e),a)):a[d]=e,!0}});return J.set(a,p),p},M=(a,b,c,d,e=!1)=>{function g(){d.call(this,...arguments,b),l.once&&l()}if(k(b)&&1===(f(b)?b:b=C(b)).length&&(b=b[0]),f(b)?!b.length:!b.addEventListener)throw new Error("nil/empty event target(s)");let h=j(c);if(null==c||!(h||k(c)))throw new TypeError("cannot listen to nil or invalid event type");if(f(b)){for(let f=0;f<b.length;f++)b[f]=M(a,b[f],h?Object.assign({},c):c,d,e);return b.off=()=>{for(const a of b)a();return b},b.on=a=>{for(const c of b)c.on(a);return b},b}if(h){for(const d in c)c[d]=M(a,b,d,c[d],e);return c}b instanceof Node&&!e.proxy&&(b=L(b));const i=a=>(null!=a&&a!==l.once&&(l.once=!!a),b.addEventListener(c,g,e),l.ison=!0,l),l=Object.assign(()=>(b.removeEventListener(c,g),l.ison=!1,l),{target:b,on:i,once:a});return l.off=l,i()},N={get:(a,b)=>(c,d,e)=>a(c,b,d,e)},O=new Proxy(M.bind(null,!1),N),P=new Proxy(M.bind(null,!0),N),Q=x(M,3),R=(a,b)=>{if(a instanceof Function&&(a=a(b)),l(a)&&(a+=""),"string"==typeof a)return Array.from(document.createRange().createContextualFragment(a).childNodes);if(a instanceof Node)return a;if(f(a))return a.map(a=>R(a));throw new Error(".html: unrenderable input")},S=a=>null==a?document.createDocumentFragment():R(a),T={props(a,b){const c=L(a);for(const e in b){let f=b[e];if(e in a)a[e]=f;else if("accessors"==e)for(const b in f){const{set:d=f[b],get:e=f[b]}=f[b],g={};d instanceof Function&&(g.set=d.bind(a,c)),e instanceof Function&&(g.get=e.bind(a,c)),Object.defineProperty(a,b,g)}else f instanceof Function&&!d(f)?a[e]=f.call(a,c):H(a,b,e)}},methods(a,b){const c=L(a);for(const d in b)Object.defineProperty(a,d,{value:b[d].bind(a,c)})}},U=a=>{const b=a.match(/([A-Z])/g);if(!b)return a;for(let c=0,d=b.length;c<d;c++)a=a.replace(new RegExp(b[c]),"-"+b[c].toLowerCase());return"-"===a[0]?a.slice(1):a},V=(a,b)=>(b=U(b))&&b in a?Reflect.get(a,b):a[b]=new Proxy(a.bind(null,b),{get(a,b){const c=b.replace(/_/g,"-").split(".");return new Proxy(function(){return a=a.apply(null,arguments),a.classList.add(...c),a},{get(a,b,d){return c.push(...b.replace(/_/g,"-").split(".")),d}})}}),W=["$","id","render","children","html","class","className"],X=(a,b,...c)=>{const d=document.createElementNS("http://www.w3.org/2000/svg",a);if(j(b))for(const a in b)q(b[a])&&-1===W.indexOf(a)&&!(a in da)&&(d.setAttribute(a,b[a]),delete b[a]);return Z(d,b,...c)},Y=new Proxy(X.bind(void 0,"svg"),{get:(a,b)=>V(X,b)}),Z=new Proxy(Object.assign((a,b,...c)=>{const e="string"==typeof a?document.createElement(a):a,g=ra.has(e.tagName);if(g)var h;let i;if(!j(b))i=L(e);else{var{pure:k,cycle:l}=b;k||(i=L(e),j(b.state)&&(b.state=i.state=b.state)),!g&&b.props&&T.props(e,b.props),b.methods&&T.methods(e,b.methods);let a;for(const c in b)if(null!=(a=b[c]))if("o"===c[0]&&"n"===c[1]){const d="c"===c[2]&&"e"===c[3],g=d?4:2,h=c.substr(0,g);let i=c.substr(g);const j=Q(d),k=f(a)?a:[a];b[h]||(b[h]={}),b[h][i]=i.length?j(e,i,...k):j(e,...k)}else if("state"==c)continue;else c in e?e[c]instanceof Function?f(a)?e[c].apply(e,a):e[c](a):e[c]=b[c]:c in da&&(a=f(a)?da[c](e,...a):da[c](e,a),a!==e&&(b[c]=a));if(l){const{mount:a,create:b,remount:c,unmount:d}=l;b&&P.create(e,b.bind(e,i||e)),a&&P.mount(e,a.bind(e,i||e)),d&&(l.unmount=O.unmount(e,d.bind(e,i||e))),c&&(l.remount=O.remount(e,c.bind(e,i||e)))}if(g&&(ta(e,void 0,void 0,b.props),h=!0),i&&b.binds)for(const a in b.binds)i.state.bind(a,b.binds[a]);const c=b.$||b.render;c?ba(c,"appendChild",e):b.renderAfter?ba(b.renderAfter,"after",e):b.renderBefore&&ba(b.renderBefore,"before",e)}if(3!==e.nodeType){if(d(b)&&(!i||b!==i))c.unshift(b(i||e));else if(b instanceof Function){const a=b.call(e,i||e);b=a===e||i&&a===i?void 0:a}v(b)&&c.unshift(b),1===c.length?ba(i||e,"appendChild",c[0]):c.length&&ba(i||e,"appendChild",...c)}return g?!h&&ta(e):ma(e,!0,g),i||e},{text:(a,b="")=>(q(a)&&([b,a]=[a,void 0]),Z(new Text(b),a)),body:(...a)=>ba(document.body||"body","appendChild",...a),svg:Y,frag:S,html:R}),{get:V}),$=(a,b,c)=>(a.dispatchEvent("string"==typeof b?new CustomEvent(b,{detail:c}):b),a),_=(a,b,c="appendChild",d=S(),e)=>{for(let g,h=0;h<a.length;h++){if(g=a[h],g instanceof Function)if((g=g(b))===b)continue;else if(g instanceof Function){let a=0,c=!1;for(;g instanceof Function&&25>a&&(g=g(),!(c=g===b));)a++;if(c)continue}const e=typeof g;if("string"==e||"number"==e){if(!g.length)continue;g=new Text(g)}else f(g)&&(g=_(g,b,c,d,!0));g instanceof Node&&(d.appendChild(g),a[h]=g)}return b&&!e&&z(()=>{b[c](d)}),a},aa=(...a)=>{for(let b,c=0;c<a.length;c++){b=a[c];const d=typeof b;if(null==b||"boolean"==d){a.splice(c,1);continue}if(b instanceof Node||b instanceof Function)continue;else if("string"==d||"number"==d){const d=c+1;if(d<a.length){const e=a[d],f=typeof e;("string"===f||"number"===f)&&(a[c]=b+""+(e+""),a.splice(d,1),c--)}else a[c]=new Text(b+"");continue}const e=b instanceof NodeList;if(e){if(2>b.length){a[c]=b[0];continue}b=Array.from(b)}else b.constructor===Object&&(b=Object.values(b));if(f(b)){if(!e&&(b=aa.apply(null,b),2>b.length)){a[c]=b[0],c--;continue}a.splice(c,1,...b),c--}else if(null!=b)throw new Error(`illegal renderable: ${b}`)}return a},ba=(a,b,...c)=>{a instanceof Function&&!d(a)&&(a=a());const e=a instanceof Node||d(a);if(c=aa(c),e)"after"!==b&&"before"!==b||t(a)?_(c,a,b):P.mount(a,()=>ba(a,b,...c));else if("string"==typeof a)return B(a).then(a=>ba(a,b,...c));return f(a)&&a.push(...c),1===c.length?c[0]:c},ca=(a,b=document.body||"body",c="appendChild")=>ba(b,c,a),da={css(a,b,c){if(b.constructor===Object)for(const c in b)da.css(a,c,b[c]);else"string"==typeof b&&("-"===b[0]?a.style.setProperty(b,c):a.style[b]=c);return a},class(a,b,d){if(!a||null==b||!a.classList)return a;if(f(a)){for(let c=0;c<a.length;c++)da.class(a[c],b,d);return a}if(b.constructor===Object)for(const c in b)da.class(a,c,b[c]);else if("string"==typeof b&&(b=b.split(" ")),f(b)){for(let c=0;c<b.length;c++)a.classList["boolean"!=typeof d?"toggle":d?"add":"remove"](b[c])}return a},hasClass:x((a,b)=>a.classList.contains(b)),attr(b,c,a){if(c.constructor===Object)for(const d in c){const a=null==c[d];b[a?"removeAttribute":"setAttribute"](d,c[d]),ia(b,d,void 0,c[d],!a)}else if("string"==typeof c){const d=b.getAttribute(c);if(null==a)return d;b.setAttribute(c,a),ia(b,c,d,a)}return b},removeAttribute(a,...b){if(1===b.length)a.removeAttribute(b[0]),ia(a,b[0],void 0,void 0,!1);else for(let c=0;c<b.length;c++)f(b[c])&&(b.splice(c,1,...b[c]),c--),a.removeAttribute(b[c]),ia(a,b[c],void 0,void 0,!1);return a},attrToggle(a,b,c=!a.hasAttribute(b),d=a.getAttribute(b)||""){return a[c?"setAttribute":"removeAttribute"](b,d),ia(a,b,c?d:null,c?null:d,c),a},emit:$,append(a,...b){return ba(a,"appendChild",...b),a},prepend(a,...b){return ba(a,"prepend",...b),a},appendTo(a,b){return ba(b,"appendChild",a),a},prependTo(a,b){return ba(b,"prepend",a),a},clear(a){return a[u(a)?"value":"textContent"]="",a},refurbish(a){for(let b=0;b<a.attributes.length;b++)a.removeAttribute(a.attributes[b].name);return a.removeAttribute("class"),da.clear(a)},remove(a,b){if(a instanceof Function&&(a=a()),f(a))for(let c=0;c<a.length;c++)da.remove(a[c],b);else if(l(b))setTimeout(()=>da.remove(a),b);else if(t(a))z(()=>a.remove());else if(o(a))for(let b=0;b<a.length;b++)da.remove(a[b]);return a},replace(a,b){return b instanceof Function&&(b=b()),z(()=>a.replaceWith(b)),b},find(a,b,c){return b=C(b,a),c?b:b.map(a=>L(a))},findOne:(a,b,c)=>c?A(b,a):(b=A(b,a))?L(b):b};da.empty=da.clear;const ea=new Map,fa=(a,b)=>ea.has(a)&&ea.get(a)(b),ga=(a,b,c)=>{a=L(a);let{init:d,update:e,remove:f}=c;d||e||!(c instanceof Function)||([d,e]=[c,c]);const g=(c,e)=>c&&!fa(b,a)?(d&&d(a,e),ea.has(b)||ea.set(b,G(new WeakSet)),ea.get(b)(a,!0),!0):fa(b,a);let h=!1,i=a.getAttribute(b);g(a.hasAttribute(b),i);const j=a.on.attr(({detail:{name:c,value:d,oldvalue:j,present:k}})=>{c===b&&i!==d&&d!==j&&g(k,d)&&(k?(e&&e(a,d,i),h=!1):!h&&(f&&f(a,d,i),h=!0),i=d)}),k=()=>{j(),ea.has(b)&&ea.get(b)(a,!1)};return k.stop=k,k.start=()=>{j.on(),ea.get(b)(a,!0)},k},ha=new Map,ia=(a,b,c,d=a.getAttribute(b),e=a.hasAttribute(b))=>{ha.has(b)&&ha.get(b).init(L(a)),d!==c&&$(a,"attr",{name:b,value:d,oldvalue:c,present:e})},ja=G(new WeakSet),ka=G(new WeakSet),la=G(new WeakSet),ma=(a,b=!ja(a),c=e(a))=>{b&&!c&&(ja(a,!0),a.dispatchEvent(new CustomEvent("create")))},na=(a,b=e(a))=>{if(ma(a,!ja(a),b),!ka(a)&&a.parentNode){if(la(a))return la(a,!1),void a.dispatchEvent(new CustomEvent("remount"));b||ka(a,!0),a.dispatchEvent(new CustomEvent("mount"))}},oa=a=>{ka(a,!1),la(a,!0),a.dispatchEvent(new CustomEvent("unmount"))},pa=a=>ta(a,"mount")||na(a),qa=a=>ta(a,"unmount")||oa(a);new MutationObserver(a=>{for(const b of a){const{addedNodes:a,removedNodes:c,attributeName:d}=b;if(a.length)for(const b of a)pa(b);if(c.length)for(const a of c)qa(a);null!=d&&ia(b.target,d,b.oldValue)}}).observe(document,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0});const ra=new Map,sa=(a,b)=>{if(i(b)&&(b=b()),-1===a.indexOf("-"))throw new Error(`component: ${a} tagName is un-hyphenated`);return ra.set(a.toUpperCase(),b),z(()=>D(a,a=>ta(a))),Z[a]};sa.plugin=a=>{if(j(a))for(const b in sa.plugins||(sa.plugins={}),a)b in sa.plugins||(sa.plugins[b]=new Set),sa.plugins.add(a[b])};const ta=(a,b,d,e)=>{if(1!==a.nodeType||!ra.has(a.tagName))return;k(b)?[d,b]=[b,ra.get(a.tagName)]:!j(b)&&(b=ra.get(a.tagName));const{create:f,mount:g,remount:h,unmount:i,props:l,methods:m,attr:n,state:o}=b,p=L(a);if(!ja(a)){if(p.state=Object.assign(Object.create(null),o,p.state),a[c]=a.tagName,m&&T.methods(a,m),l&&T.props(a,l),e&&T.props(a,e),ja(a,!0),f&&f.call(a,p),sa.plugins&&(sa.plugins.config.forEach(c=>{c.bind(a,b,p,a)}),sa.plugins.create.forEach(b=>{b.bind(a,p,a)})),$(a,"create"),j(b.on)&&p.on(b.on),j(b.once)&&p.once(b.once),j(n))for(const b in p.state.observedAttrs=Object.create(null),n)p.state.observedAttrs[b]=ga(a,b,n[b]);h&&p.on.remount(h.bind(a,p))}if(!ka(a)&&("mount"===d||t(a))){if(la(a)){for(const b in sa.plugins&&sa.plugins.remount.forEach(b=>{b.bind(a,p,a)}),p.state.observedAttrs)p.state.observedAttrs[b].start();h&&h.call(a,p),$(a,"remount")}else ka(a,!0),sa.plugins&&sa.plugins.mount.forEach(b=>{b.bind(a,p,a)}),g&&g.call(a,p),$(a,"mount");}else if("unmount"===d){for(const b in ka(a,!1),la(a,!0),sa.plugins&&sa.plugins.unmount.forEach(b=>{b.bind(a,p,a)}),p.state.observedAttrs)p.state.observedAttrs[b].stop();i&&i.call(a,p),$(a,d)}return a};a.isArr=f,a.isComponent=e,a.isNil=g,a.isDef=h,a.isObj=j,a.isFunc=i,a.isBool=a=>"boolean"==typeof a,a.isStr=k,a.isNum=l,a.isArrlike=n,a.isNodeList=o,a.isNode=p,a.isMounted=t,a.isPrimitive=q,a.isPromise=s,a.isProxyNode=d,a.isRenderable=v,a.isRegExp=a=>a instanceof RegExp,a.isInt=m,a.isInput=u,a.isEmpty=a=>g(a)||!((j(a)?Object.keys(a):a).length||a.size),a.isEl=r,a.isSvg=a=>(d(a)&&(a=a()),a instanceof SVGElement),a.allare=w,a.attributeObserver=ga,a.flatten=y,a.curry=x,a.compose=(...a)=>a.reduce((c,a)=>(...b)=>c(a(...b))),a.components=ra,a.component=sa,a.run=z,a.render=ca,a.query=A,a.queryAsync=B,a.queryAll=C,a.queryEach=D,a.on=O,a.once=P,a.each=E,a.svg=Y,a.dom=Z,a.domfn=da,a.html=R,a.directive=(a,b)=>{const c=new Map;return c.init=d=>{fa(a,d)||c.set(d,ga(d,a,b))},c.stop=a=>{c.has(a)&&c.get(a)()},ha.set(a,c),z(()=>D("["+a+"]",b=>ia(b,a))),c},a.directives=ha,a.prime=aa,a.merge=I,a.Mounted=ka,a.Unmounted=la,a.Created=ja,a.$=L,Object.defineProperty(a,"__esModule",{value:!0})});