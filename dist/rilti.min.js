(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.rilti={})})(this,function(a){"use strict";const b=Symbol("Proxy Node"),c=Symbol("Component"),d=a=>i(a)&&!0===a[b],e=a=>a!==void 0&&a[c]!==void 0,f=Array.isArray,g=a=>null==a,h=a=>null!=a,i=a=>a instanceof Function,j=a=>null!=a&&a.constructor===Object,k=a=>"string"==typeof a,l=a=>"number"==typeof a&&!isNaN(a),m=a=>l(a)&&0==a%1,n=a=>f(a)||a instanceof window.NodeList||h(a)&&!(i(a)||p(a))&&0==a.length%1,o=(a,b=!0)=>a instanceof window.NodeList||b&&v(a,p),p=a=>a instanceof window.Node,q=a=>(a=typeof a,"string"===a||"number"===a||"boolean"===a),r=a=>a instanceof window.Element,s=(a,b=document)=>o(a)?Array.from(a).every(a=>s(a)):b===a||!!(16&b.compareDocumentPosition(a)),t=a=>(d(a)&&(a=a()),a instanceof window.HTMLInputElement||a instanceof window.HTMLTextAreaElement),u=a=>a instanceof window.Node||d(a)||q(a)||v(a,u),v=(a,b)=>{if(n(a)){const c=b instanceof Function;for(let d=0;d<a.length;d++)if(c?!b(a[d]):a[d]!==b)return!1;return!0}return!1},w=(a,b=a.length,...c)=>b<=c.length?a(...c):w.bind(void 0,a,b,...c),x=(a,b=[],c=!0)=>{if(c&&!f(a))return[a];for(let d=0;d<a.length;d++)f(a[d])?x(a[d],b):b.push(a[d]);return b};a.runAsync=(a,...b)=>window.requestIdleCallback(a.bind(void 0,...b)),window.requestIdleCallback||(a.runAsync=(a,...b)=>setTimeout(a,0,...b));const y=function(){document.body||"complete"===document.readyState?a.runAsync.apply(void 0,arguments):window.addEventListener("DOMContentLoaded",()=>a.runAsync.apply(void 0,arguments),{once:!0})},z=(a,b=document)=>p(a)?a:z(b).querySelector(a),A=(a,b)=>new Promise((c,d)=>{const e=()=>{const e=z(a,b);null==e?d(new Error("queryAsync: couldn't find "+a)):c(e)};document.body?e():y(e)}),B=(a,b=document)=>Array.from(z(b).querySelectorAll(a)),C=(a,b,c=document)=>(i(b)||([b,c]=[c,document]),D(B(a,c),b)),D=(a,b)=>{if(h(a))if(j(a))for(const c in a)b(a[c],c,a);else if(a.length){const c=a.length;for(let d=0;d!==c;)b(a[d],d++,a)}else if(a.forEach)a.forEach(b);else if(m(a))for(let c=0;c<a;)b(c++,a);return a},E=(a,b)=>new Proxy(a,{get:!0===b?(a,b)=>b in a?Reflect.get(a,b):a.bind(void 0,b):(a,b)=>a.bind(void 0,b)}),F=a=>(b,c)=>a[null==c?"has":c?"add":"delete"](b),G=new Map,H=(a={})=>{const b=new Map;b.add=(a,c)=>{b.has(a)||b.set(a,new Set),b.get(a).add(c)},b.remove=(a,c)=>{b.has(a)&&(c?b.get(a).delete(c):b.each(a,a=>a.revoke()),!b.get(a).size&&b.delete(a))},b.each=(a,c)=>{b.has(a)&&b.get(a).forEach(c)};const c=(c,d,f,g)=>(f&&(d=f(d,e)),b.add(c,d),c in a&&d(a[c],void 0,e),d.revoke=()=>{g&&g(e),b.remove.bind(void 0,c,d)},d);c.text=(d,f,g)=>{const h=new window.Text,i=a=>{h.textContent=a},j=c(d,i,void 0,()=>{g&&g(e),$.remove(h)});return d in a&&i(a[d]),f&&f(j),h};const d=c=>(b.remove(c),delete a[c]),e=new Proxy((a,...b)=>{if(a.constructor===Object)for(const b in a)e[b]=a[b];else if("string"==typeof a)e[a]=b[0];else if(f(a))return x(b.reduce((b,d,e)=>[b,c.text(d),a[e+1]],a[0]).filter(a=>!k(a)||a.length))},{get:(b,d)=>"bind"===d?c:"$"===d[0]?c.bind(void 0,d.split("$")[1]):Reflect.get(a,d),set(c,f,g){if(null==g)d(f);else{const c=a[f];g!==c&&(a[f]=g,b.each(f,a=>a(g,c,e)))}return!0},deleteProperty:(a,b)=>d(b)});return e},I=a=>{if(d(a))return a;if("string"==typeof a&&(a=z(a)),G.has(a))return G.get(a);if(!(a instanceof window.Node))throw new TypeError(`$ needs a Node: ${a}`);const c=new Proxy((b,c)=>($.class(a,b,c),o),{get:(b,c)=>a.classList.contains(c),set:(a,b,c)=>a(b,c),deleteProperty:(b,c)=>!!a.classList.remove(c)});if(r(a))var e=a.getAttribute.bind(a),f=a.hasAttribute.bind(a),g=$.removeAttribute.bind(void 0,a),h=new Proxy((b,c)=>{const d=$.attr(a,b,c);return d===a?o:d},{get:(a,b)=>"has"===b?f:"remove"===b?g:e(b),set(a,b,c){return"remove"===b?g(c):a(b,c),!0},deleteProperty:(b,c)=>$.removeAttribute(a,c)});const j=t(a)?"value":"textContent",l=t(a)?"value":3===a.nodeType?j:"innerHTML",m=E(J(!0,a),!1),n=E(J(!1,a),!1),o=new Proxy(Object.assign(b=>(b instanceof Function&&!d(b)&&b.call(a,o,a),a),{class:c,attr:h,on:n,once:m,emit:V.bind(void 0,a),render:Z.bind(void 0,a)}),{get(c,e){return Reflect.has(c,e)?Reflect.get(c,e):"txt"===e?a[j]:"html"===e?a[l]:"mounted"===e?s(a):"children"===e?Array.from(a.children):"$children"===e?Array.prototype.map.call(a.children,I):"parent"===e&&a.parentNode?I(a.parentNode):"state"===e?c[e]||(c[e]=H()):e in $?(...b)=>{const c=$[e](a,...b);return c===a||c===o?o:c}:e===b||(i(a[e])&&!d(a[e])?a[e].bind(a):a[e])},set(b,d,e){return"class"===d?c(a,e):"attr"===d?h(a,e):"css"===d?$.css(a,e):"state"===d?(b[d]||o[d])(e):"txt"===d?a[j]=e:"html"===d||"children"===d?k(e)?a[l]=e:(a[j]="",W(X(e),a)):a[d]=e,!0}});return G.set(a,o),o},J=w((a,b,c,d,e=!1)=>{if("string"==typeof b&&(b=z(b)),c===Object(c)){for(const d in c)c[d]=J(a,b,d,c[d],e);return c}if(!(d instanceof Function))return J.bind(void 0,a,b,c);d=d.bind(b);const f=b instanceof window.Node?I(b):b,g=b=>{d(b,f),a&&h()},h=()=>(b.removeEventListener(c,g),j),i=d=>(a=!!d,b.addEventListener(c,g,e),j),j={handler:g,on:i,off:h,once:i.bind(void 0,!0),emit(a,c){return b.dispatchEvent(new window.CustomEvent(a,{detail:c})),j}};return i(a)},3),K={get:(a,b)=>(c,d,e)=>a(c,b,d,e)},L=new Proxy(J(!0),K),M=new Proxy(J(!1),K),N=(a,b)=>(a instanceof Function&&(a=a(b)),"string"==typeof a)?Array.from(document.createRange().createContextualFragment(a).childNodes):a instanceof window.Node?a:f(a)?a.map(a=>N(a)):void 0,O=a=>a===void 0?document.createDocumentFragment():N(a),P={props(a,b){const c=I(a);for(const e in b){let f=b[e];if(e in a)a[e]=f;else if("accessors"==e)for(const b in f){const{set:d=f[b],get:e=f[b]}=f[b],g={};d instanceof Function&&(g.set=d.bind(a,c)),e instanceof Function&&(g.get=e.bind(a,c)),Object.defineProperty(a,b,g)}else f instanceof Function&&!d(f)?a[e]=f.call(a,c):Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(b,e))}},methods(a,b){const c=I(a);for(const d in b)Object.defineProperty(a,d,{value:b[d].bind(a,c)})}},Q=(a,b)=>{if(Reflect.has(a,b))return Reflect.get(a,b);const c=a.bind(void 0,b);return c.$classes=[],a[b]=new Proxy(c,{apply(c,d,e){if(c=c(...e),a[b].$classes.length){for(let d=0;d<a[b].$classes.length;d++)c.classList.add(a[b].$classes[d]);a[b].$classes.length=0}return c},get(a,b,c){return"$classes"===b?a.$classes:(a.$classes.push(...b.replace(/_/g,"-").split(".")),c)}})},R=["$","id","render","children","html","class","className"],S=(a,b,...c)=>{const d=document.createElementNS("http://www.w3.org/2000/svg",a);if(j(b))for(const a in b)q(b[a])&&-1===R.indexOf(a)&&!(a in $)&&(d.setAttribute(a,b[a]),b[a]=void 0);return U(d,b,...c)},T=new Proxy(S.bind(void 0,"svg"),{get:(a,b)=>Q(S,b)}),U=new Proxy(Object.assign((a,b,...c)=>{const e="string"==typeof a?document.createElement(a):a,g=ma.has(e.tagName);if(g)var h;const i=I(e);if(j(b)){var{pure:k}=b;for(const a in!g&&b.props&&P.props(e,b.props),b.methods&&P.methods(e,b.methods),j(b.state)&&(i.state=b.state),b){let c=b[a];if(null!=c)if("o"===a[0]&&"n"===a[1]){const d="c"===a[2]&&"e"===a[3],g=d?4:2,h=a.substr(0,g);let i=a.substr(g);const j=J(d),k=f(c)?c:[c];b[h]||(b[h]={}),b[h][i]=i.length?j(e,i,...k):j(e,...k)}else a in e?"function"==typeof e[a]?f(c)?e[a].apply(e,c):e[a](c):e[a]=b[a]:a in $&&(c=f(b[a])?$[a](e,...c):$[a](e,c),c!==e&&(b[a]=c))}if(b.cycle){const{mount:a,create:c,remount:d,unmount:f}=b.cycle;c&&L.create(e,c.bind(e,i)),a&&L.mount(e,a.bind(e,i)),b.cycle.unmount=f&&M.unmount(e,f.bind(e,i)),b.cycle.remount=d&&M.remount(e,d.bind(e,i))}g&&(oa(e,void 0,void 0,b.props),h=!0);const a=b.$||b.render;a?Y(a,"appendChild",e):b.renderAfter?Y(b.renderAfter,"after",e):b.renderBefore&&Y(b.renderBefore,"before",e)}if(3!==e.nodeType){if(d(b)&&b!==i)c.unshift(b(i));else if(b instanceof Function){const a=b.call(e,i);b=a!==e&&a!==i?a:void 0}u(b)&&c.unshift(b),c.length&&Y(i,"appendChild",...c)}return g?!h&&oa(e,void 0):ha(e,!0,g),k?e:i},{text:(a,b="")=>(q(a)&&([b,a]=[a,void 0]),U(new window.Text(b),a)),body:(...a)=>(Y(document.body||"body","appendChild",...a),1<a.length?a:a[0]),svg:T,frag:O,html:N}),{get:Q}),V=(a,b,c)=>(a.dispatchEvent(new window.CustomEvent(b,{detail:c})),a),W=(a,b,c="appendChild",d=O(),e)=>{for(let g,h=0;h<a.length;h++){if(g=a[h],g instanceof Function)if((g=g(b))===b)continue;else if(g instanceof Function){let a=0,c=!1;for(;g instanceof Function&&25>a&&(g=g(),!(c=g===b));)a++;if(c)continue}if("string"==typeof g){if(!g.length)continue;g=new window.Text(g)}else f(g)&&(g=W(g,b,c,d,!0));g instanceof window.Node&&(d.appendChild(g),a[h]=g)}return b&&!e&&y(()=>{b[c](d);for(let b=0;b<a.length;b++)a[b]&&a[b].dispatchEvent&&ia(a[b])}),a},X=(...a)=>{for(let b,c=0;c<a.length;c++){if(b=a[c],null==b||"boolean"==typeof b){a.splice(c,1);continue}if(b instanceof window.Node||b instanceof Function)continue;else if("string"==typeof b||"number"==typeof b){const d=c+1;if(d<a.length){const e=a[d];"string"==typeof e||"number"==typeof e?(a[c]=new window.Text(b+""+(e+"")),a.splice(d,1),c--):a[c]=new window.Text(b+"")}continue}const d=b instanceof window.NodeList;if(d){if(2>b.length){a[c]=b[0];continue}b=Array.from(b)}else b.constructor===Object&&(b=Object.values(b));if(f(b)){if(!d&&(b=X.apply(void 0,b),2>b.length)){a[c]=b[0],c--;continue}a.splice(c,1,...b),c--}else if(h(b))throw new Error(`illegal renderable: ${b}`)}return a},Y=(a,b,...c)=>{a instanceof Function&&!d(a)&&(a=a());const e=a instanceof window.Node||d(a);if(c=X(c),e)"after"!==b&&"before"!==b||s(a)?W(c,a,b):L.mount(a,()=>Y(a,b,...c));else if("string"==typeof a)return A(a).then(a=>Y(a,b,...c));return f(a)&&a.push(...c),2>c.length?c[0]:c},Z=(a,b=document.body||"body",c="appendChild")=>Y(b,c,a),$={css(a,b,c){if(b.constructor===Object)for(const c in b)$.css(a,c,b[c]);else"string"==typeof b&&("-"===b[0]?a.style.setProperty(b,c):a.style[b]=c);return a},class(a,b,d){if(!a||null==b||!a.classList)return a;if(f(a)){for(let c=0;c<a.length;c++)$.class(a[c],b,d);return a}if(b.constructor===Object)for(const c in b)$.class(a,c,b[c]);else if("string"==typeof b&&(b=b.split(" ")),f(b)){for(let c=0;c<b.length;c++)a.classList["boolean"==typeof d?d?"add":"remove":"toggle"](b[c])}return a},hasClass:w((a,b)=>a.classList.contains(b)),attr(b,c,a){if(c.constructor===Object)for(const d in c){const a=null==c[d];b[a?"removeAttribute":"setAttribute"](d,c[d]),da(b,d,void 0,c[d],!a)}else if("string"==typeof c){const d=b.getAttribute(c);if(null==a)return d;b.setAttribute(c,a),da(b,c,d,a)}return b},removeAttribute(a,...b){if(1===b.length)a.removeAttribute(b[0]),da(a,b[0],void 0,void 0,!1);else for(let c=0;c<b.length;c++)f(b[c])&&(b.splice(c,1,...b[c]),c--),a.removeAttribute(b[c]),da(a,b[c],void 0,void 0,!1);return a},attrToggle(a,b,c=!a.hasAttribute(b),d=a.getAttribute(b)||""){return a[c?"setAttribute":"removeAttribute"](b,d),da(a,b,c?d:null,c?null:d,c),a},emit:V,append(a,...b){return Y(a,"appendChild",...b),a},prepend(a,...b){return Y(a,"prepend",...b),a},appendTo(a,b){return Y(b,"appendChild",a),a},prependTo(a,b){return Y(b,"prepend",a),a},clear(a){return a[t(a)?"value":"textContent"]="",a},refurbish(a){for(let b=0;b<a.attributes.length;b++)a.removeAttribute(a.attributes[b].name);return a.removeAttribute("class"),$.clear(a)},remove(a,b){if(a instanceof Function&&(a=a()),f(a))for(let c=0;c<a.length;c++)$.remove(a[c],b);else if(l(b))setTimeout(()=>$.remove(a),b);else if(s(a))y(()=>a.remove());else if(o(a))for(let b=0;b<a.length;b++)$.remove(a[b]);return a},replace(a,b){return i(b)&&(b=b()),y(()=>a.replaceWith(b)),b}};$.empty=$.clear;const _=new Map,aa=(a,b)=>_.has(a)&&_.get(a)(b),ba=(a,b,c)=>{a=I(a);const{init:d,update:e,remove:f}=c,g=(c,e)=>c&&!aa(b,a)?(d&&d(a,e),_.has(b)||_.set(b,F(new WeakSet)),_.get(b)(a,!0),!0):aa(b,a);let h=!1,i=a.getAttribute(b);g(a.hasAttribute(b),i);const j=a.on.attr(({detail:{name:c,value:d,oldvalue:j,present:k}})=>{c===b&&i!==d&&d!==j&&g(k,d)&&(k?(e&&e(a,d,i),h=!1):!h&&(f&&f(a,d,i),h=!0),i=d)}).off;return()=>{j(),_.has(b)&&_.get(b)(a,!1)}},ca=new Map,da=(a,b,c,d=a.getAttribute(b),e=a.hasAttribute(b))=>{ca.has(b)&&ca.get(b).init(I(a)),V(a,"attr",{name:b,value:d,oldvalue:c,present:e})},ea=F(new WeakSet),fa=F(new WeakSet),ga=F(new WeakSet),ha=(a,b=!ea(a),c=e(a))=>{b&&!c&&(ea(a,!0),a.dispatchEvent(new window.CustomEvent("create")))},ia=(a,b=e(a))=>{ha(a,!ea(a),b),fa(a)||(ga(a)?(ga(a,!1),a.dispatchEvent(new window.CustomEvent("remount"))):b?a.dispatchEvent(new window.CustomEvent("mount")):(fa(a,!0),a.dispatchEvent(new window.CustomEvent("mount"))))},ja=a=>{fa(a,!1),ga(a,!0),a.dispatchEvent(new window.CustomEvent("unmount"))},ka=a=>oa(a,"mount")||ia(a),la=a=>oa(a,"unmount")||ja(a);new window.MutationObserver(a=>{for(let b=0;b<a.length;b++){const{addedNodes:c,removedNodes:d,attributeName:e}=a[b];if(c.length)for(let a=0;a<c.length;a++)ka(c[a]);if(d.length)for(let a=0;a<d.length;a++)la(d[a]);"string"==typeof e&&da(a[b].target,e,a[b].oldValue)}}).observe(document,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0});const ma=new Map,na=(a,b)=>{if(-1===a.indexOf("-"))throw new Error(`component: ${a} tagName is un-hyphenated`);return ma.set(a.toUpperCase(),b),y(()=>C(a,oa)),U[a]};na.plugin=a=>{if(j(a))for(const b in na.plugins||(na.plugins={}),a)b in na.plugins||(na.plugins[b]=new Set),na.plugins.add(a[b])};const oa=(a,b,d,e)=>{if(1!==a.nodeType||!ma.has(a.tagName))return;k(b)?[d,b]=[b,ma.get(a.tagName)]:!j(b)&&(b=ma.get(a.tagName));const{create:f,mount:g,remount:h,unmount:i,props:l,methods:m,attr:n,state:o}=b,p=I(a);if(!ea(a)){if(p.state=o,a[c]=a.tagName,m&&P.methods(a,m),l&&P.props(a,l),e&&P.props(a,e),ea(a,!0),f&&f.call(a,p),na.plugins&&(na.plugins.config.forEach(c=>{c.bind(a,b,p,a)}),na.plugins.create.forEach(b=>{b.bind(a,p,a)})),V(a,"create"),j(b.on)&&p.on(b.on),j(b.once)&&p.once(b.once),j(n))for(const b in n)ba(a,b,n[b]);h&&p.on.remount(h.bind(a,p))}return fa(a)||"mount"!==d?"unmount"===d&&(fa(a,!1),ga(a,!0),na.plugins&&na.plugins.unmount.forEach(b=>{b.bind(a,p,a)}),i&&i.call(a,p),V(a,d)):ga(a)?(na.plugins&&na.plugins.remount.forEach(b=>{b.bind(a,p,a)}),h&&h.call(a,p),V(a,"remount")):(fa(a,!0),na.plugins&&na.plugins.mount.forEach(b=>{b.bind(a,p,a)}),g&&g.call(a,p),V(a,d)),a};a.isArr=f,a.isComponent=e,a.isNil=g,a.isDef=h,a.isObj=j,a.isFunc=i,a.isBool=a=>"boolean"==typeof a,a.isStr=k,a.isNum=l,a.isArrlike=n,a.isNodeList=o,a.isNode=p,a.isMounted=s,a.isPrimitive=q,a.isPromise=a=>"object"==typeof a&&i(a.then),a.isProxyNode=d,a.isRenderable=u,a.isRegExp=a=>a instanceof RegExp,a.isInt=m,a.isInput=t,a.isEmpty=a=>g(a)||!((j(a)?Object.keys(a):a).length||a.size),a.isEl=r,a.isSvg=a=>(d(a)&&(a=a()),a instanceof window.SVGElement),a.allare=v,a.attributeObserver=ba,a.flatten=x,a.curry=w,a.compose=(...a)=>a.reduce((c,a)=>(...b)=>c(a(...b))),a.components=ma,a.component=na,a.run=y,a.render=Z,a.query=z,a.queryAsync=A,a.queryAll=B,a.queryEach=C,a.on=M,a.once=L,a.each=D,a.svg=T,a.dom=U,a.domfn=$,a.html=N,a.directive=(a,{init:b,update:c,remove:d})=>{const e=new Map;return e.init=f=>{aa(a,f)||e.set(f,ba(f,a,{init:b,update:c,remove:d}))},e.stop=a=>{e.has(a)&&e.get(a)()},ca.set(a,e),y(()=>C("["+a+"]",b=>da(b,a))),e},a.directives=ca,a.prime=X,a.Mounted=fa,a.Unmounted=ga,a.Created=ea,a.$=I,Object.defineProperty(a,"__esModule",{value:!0})});