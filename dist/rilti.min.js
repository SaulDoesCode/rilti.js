(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.rilti={})})(this,function(a){"use strict";const b=Symbol("Model"),c=Symbol("Proxy Node"),d=Symbol("Component"),e=a=>j(a)&&!0===a[b],f=a=>k(a)&&!0===a[c],g=a=>a!==void 0&&a[d]!==void 0,h=Array.isArray,i=a=>a===void 0||null===a,j=a=>a!==void 0&&null!==a,k=a=>a instanceof Function,l=a=>"boolean"==typeof a,m=a=>"object"==typeof a&&a.constructor===Object,n=a=>"string"==typeof a,p=a=>"number"==typeof a&&!isNaN(a),o=a=>p(a)&&0==a%1,q=a=>h(a)||a instanceof window.NodeList||j(a)&&!(k(a)||s(a))&&0==a.length%1,r=(a,b=!0)=>a instanceof window.NodeList||b&&A(a,s),s=a=>a instanceof window.Node,t=a=>(a=typeof a,"string"===a||"number"===a||"boolean"===a),u=a=>a instanceof window.Element,v=a=>"object"==typeof a&&k(a.then),w=a=>a instanceof RegExp,x=(a,b=document)=>r(a)?Array.from(a).every(a=>x(a)):b===a||!!(16&b.compareDocumentPosition(a)),y=a=>(f(a)&&(a=a()),a instanceof window.HTMLInputElement||a instanceof window.HTMLTextAreaElement),z=a=>a instanceof window.Node||f(a)||t(a)||A(a,z),A=(a,b)=>{if(q(a)){const c=b instanceof Function;for(let d=0;d<a.length;d++)if(c?!b(a[d]):a[d]!==b)return!1;return!0}return!1},B=(a,b=a.length,...c)=>b<=c.length?a(...c):B.bind(void 0,a,b,...c),C=(a,b=[],c=!0)=>{if(c&&!h(a))return[a];for(let d=0;d<a.length;d++)h(a[d])?C(a[d],b):b.push(a[d]);return b},D=a=>{document.body||"complete"===document.readyState?setTimeout(a,0):window.addEventListener("DOMContentLoaded",a)},E=(a,b=document)=>s(a)?a:E(b).querySelector(a),F=(a,b)=>new Promise((c,d)=>{const e=()=>{const e=E(a,b);i(e)?d(new Error(`queryAsync: couldn't find ${a}`)):c(e)};document.body?e():D(e)}),G=(a,b=document)=>Array.from(E(b).querySelectorAll(a)),H=(a,b,c=document)=>(k(b)||([b,c]=[c,document]),I(G(a,c),b)),I=(a,b)=>{if(j(a))if(m(a))for(const c in a)b(a[c],c,a);else if(a.length){const c=a.length;for(let d=0;d!==c;)b(a[d],d++,a)}else if(a.forEach)a.forEach(b);else if(o(a))for(let c=0;c<a;)b(c++,a);return a},J=(a,b=!1)=>new Proxy(a,{get:(a,c)=>b&&c in a?Reflect.get(a,c):a.bind(void 0,c)}),K=a=>(b,c)=>a[c===void 0?"has":c?"add":"delete"](b);const L=new Map,M=a=>{if(f(a))return a;if("string"==typeof a&&(a=E(a)),L.has(a))return L.get(a);if(!s(a))throw new TypeError(`$ needs a Node: ${a}`);const b=new Proxy((...b)=>(ia.class(a,...b),p),{get:(b,c)=>a.classList.contains(c),set:(a,b,c)=>a(b,c),deleteProperty:(b,c)=>!!a.classList.remove(c)});if(u(a))var d=a.getAttribute.bind(a),g=a.hasAttribute.bind(a),h=ia.removeAttribute.bind(void 0,a),i=new Proxy((b,c)=>{const d=ia.attr(a,b,c);return d===a?p:d},{get(a,b){return"has"===b?g:"remove"===b||"rm"===b?h:d(b)},set(a,b,c){return"remove"===b?h(c):a(b,c),!0},deleteProperty:(b,c)=>ia.removeAttribute(a,c)});const j=y(a)?"value":"textContent",l=y(a)?"value":3===a.nodeType?j:"innerHTML",m=J(N(!0,a),!1),o=J(N(!1,a),!1),p=new Proxy(b=>(k(b)&&!f(b)&&b.call(a,p,a),a),{get(d,g){return"class"===g?b:"attr"===g?i:"txt"===g?a[j]:"html"===g?a[l]:"on"===g?o:"once"===g?m:"emit"===g?da.bind(void 0,a):"mounted"===g?x(a):"render"===g?ha.bind(a,a):"children"===g?Array.from(a.children):"$children"===g?Array.from(a.children).map(M):"parent"===g&&a.parentNode?M(a.parentNode):g in ia?(...b)=>{const c=ia[g](a,...b);return c===a||c===p?p:c}:g===c||(!k(a[g])||f(a[g])||e(a[g])?a[g]:a[g].bind(a))},set(c,d,e){return"class"===d?b(a,e):"attr"===d?i(a,e):"css"===d?ia.css(a,e):"txt"===d?a[j]=e:"html"===d||"children"===d?n(e)?a[l]=e:(a[j]="",ea(fa(e),a)):a[d]=e,!0}});return L.set(a,p),p},N=B((a,b,c,d,e=!1)=>{if(n(b)&&(b=E(b)),m(c)){for(const d in c)c[d]=N(a,b,d,c[d],e);return c}if(!k(d))return N.bind(void 0,a,b,c);d=d.bind(b);const f=u(b)?M(b):b,g=b=>{d(b,f),a&&h()},h=()=>(b.removeEventListener(c,g),j),i=d=>(a=!!d,b.addEventListener(c,g,e),j),j={handler:g,on:i,off:h,once:i.bind(void 0,!0),emit(a,c){return b.dispatchEvent(new window.CustomEvent(a,{detail:c})),j}};return i(a)},3),O={get:(a,b)=>(c,d,e)=>a(c,b,d,e)},P=new Proxy(N(!0),O),Q=new Proxy(N(!1),O),R=(a,b)=>(a instanceof Function&&(a=a(b)),"string"==typeof a)?Array.from(document.createRange().createContextualFragment(a).childNodes):a instanceof window.Node?a:h(a)?a.map(a=>R(a)):void 0,S=a=>a===void 0?document.createDocumentFragment():R(a),T={props(a,b){const c=M(a);for(const d in b){let g=b[d];if(d in a)a[d]=g;else if("accessors"==d)for(const b in g){const{set:d=g[b],get:e=g[b]}=g[b],f={};k(d)&&(f.set=d.bind(a,c)),k(e)&&(f.get=e.bind(a,c)),Object.defineProperty(a,b,f)}else!k(g)||f(g)||e(g)?Object.defineProperty(a,d,Object.getOwnPropertyDescriptor(b,d)):a[d]=g.call(a,c)}},methods(a,b){const c=M(a);for(const d in b)Object.defineProperty(a,d,{value:b[d].bind(a,c)})}},U=(a,b)=>b in a?Reflect.get(a,b):new Proxy(a.bind(void 0,b),{get(a,b){const c=[b.replace(/_/g,"-")];return new Proxy((...b)=>(a=a(...b),ia.class(a(),c),a),{get(a,b,d){return c.push(b.replace(/_/g,"-")),d}})}}),V=J(function(a,b){const c="string"==typeof a?document.createElement(a):a;let d=Array.prototype.slice.call(arguments,2);if(m(b))for(const a in b)a in c?c[a]=b[a]:"$"==a||"render"==a?b[a].nodeType?b[a].appendChild(c):ga(b[a],"appendChild",c):ia.hasOwnProperty(a)?ia[a](c,b[a]):0===a.indexOf("on")?Q(c,b[a]):0===a.indexOf("once")?P(c,b[a]):c.setAttribute(a,b[a]);else"string"==typeof b?c.appendChild(new window.Text(b)):b instanceof window.Node?c.appendChild(b):b instanceof Function?d.unshift(b(c)):(h(b)||b instanceof window.NodeList)&&(d=Array.prototype.concat.call(b,d));if(d.length){const a=S();for(let b,e=0;e<d.length;e++)b=d[e],b instanceof Function&&(b=b(c)),b instanceof window.Node?a.appendChild(b):h(b)?ea(b,c,"appendChild",a,!0):void 0!==b&&a.appendChild(new window.Text(b));c.appendChild(a)}return c}),W=["$","id","render","children","html","class","className"],X=(a,b,...c)=>{const d=document.createElementNS("http://www.w3.org/2000/svg",a);if(m(b))for(const a in b)t(b[a])&&-1===W.indexOf(a)&&!(a in ia)&&(d.setAttribute(a,b[a]),b[a]=void 0);return Z(d,b,...c)},Y=new Proxy(X.bind(void 0,"svg"),{get:(a,b)=>U(X,b)}),Z=new Proxy(Object.assign((a,b,...c)=>{const d="string"==typeof a?document.createElement(a):a,e=ra.has(d.tagName);if(e)var g;const i=M(d);if(m(b)){var j=b.pure;for(const a in!e&&b.props&&T.props(d,b.props),b.methods&&T.methods(d,b.methods),b.sync&&(b.sync=b.sync(d)),b){let c=b[a];const e=0===a.indexOf("once"),f=!e&&0===a.indexOf("on");if(e||f){const f=e?4:2,g=a.substr(0,f);let i=a.substr(f);const j=N(e),k=h(c)?c:[c];b[g]||(b[g]={}),b[g][i]=i.length?j(d,i,...k):j(d,...k)}else a in d?k(d[a])?h(c)?d[a].apply(d,c):d[a](c):d[a]=b[a]:a in ia&&(c=h(b[a])?ia[a](d,...c):ia[a](d,c),c!==d&&(b[a]=c))}if(b.cycle){const{mount:a,create:c,remount:e,unmount:f}=b.cycle;c&&P.create(d,c.bind(d,i)),a&&P.mount(d,a.bind(d,i)),b.cycle.unmount=f&&Q.unmount(d,f.bind(d,i)),b.cycle.remount=e&&Q.remount(d,e.bind(d,i))}e&&(sa(d,void 0,void 0,b.props),g=!0);const a=b.$||b.render;a?ga(a,"appendChild",d):b.renderAfter?ga(b.renderAfter,"after",d):b.renderBefore&&ga(b.renderBefore,"before",d)}if(3!==d.nodeType){if(f(b)&&b!==i)c.unshift(b(i));else if(b instanceof Function){const a=b.call(d,i);b=a!==d&&a!==i?a:void 0}z(b)&&c.unshift(b),c.length&&ga(d,"appendChild",...c)}return e?!g&&sa(d,void 0):ma(d,!0,e),j?d:i},{text:(a,b="")=>(t(a)&&([b,a]=[a,void 0]),Z(new window.Text(b),a)),body:(...a)=>(ga(document.body||"body","appendChild",...a),1<a.length?a:a[0]),svg:Y,frag:S,html:R}),{get:U}),$=new Map,_=(a,b)=>$.has(a)&&$.get(a)(b),aa=(a,b,c)=>{a=M(a);const{init:d,update:e,remove:f}=c,g=(c,e)=>c&&!_(b,a)?(d&&d(a,e),$.has(b)||$.set(b,K(new WeakSet)),$.get(b)(a,!0),!0):_(b,a);let h=!1,i=a.getAttribute(b);g(a.hasAttribute(b),i);const j=a.on.attr(({detail:{name:c,value:d,oldvalue:j,present:k}})=>{b===c&&i!==d&&d!==j&&g(k,d)&&(k?(e&&e(a,d,i),h=!1):!h&&(f&&f(a,d,i),h=!0),i=d)}).off;return()=>{j(),$.has(b)&&$.get(b)(a,!1)}},ba=new Map,ca=(a,b,c,d=a.getAttribute(b),e=a.hasAttribute(b))=>{ba.has(b)&&ba.get(b).init(M(a)),da(a,"attr",{name:b,value:d,oldvalue:c,present:e})},da=(a,b,c)=>(a.dispatchEvent(new window.CustomEvent(b,{detail:c})),a),ea=(a,b,c="appendChild",d=S(),e)=>{for(let f,g=0;g<a.length;g++){if(f=a[g],f instanceof Function)if((f=f(b))===b)continue;else if(f instanceof Function){let a=0,c=!1;for(;f instanceof Function&&25>a&&(f=f(),!(c=f===b));)a++;if(c)continue}if("string"==typeof f){if(!f.length)continue;f=new window.Text(f)}else h(f)&&(f=ea(f,b,c,d,!0));f instanceof window.Node&&(d.appendChild(f),a[g]=f)}if(b&&!e){b[c](d);for(let b=0;b<a.length;b++)a[b]&&a[b].dispatchEvent&&na(a[b])}return a},fa=(...a)=>{for(let b,c=0;c<a.length;c++){if(b=a[c],b instanceof window.Node||b instanceof Function)continue;else if(t(b)){a[c]=new window.Text(b);continue}const d=b instanceof window.NodeList;if(d){if(2>b.length){a[c]=b[0];continue}b=Array.from(b)}else m(b)&&(b=Object.values(b));if(h(b)){if(!d&&(b=fa.apply(void 0,b),2>b.length)){a[c]=b[0];continue}const e=b.length;b.unshift(c,1),a.splice.apply(a,b),b.slice(2,0),c+=e}else if(j(b))throw new Error(`illegal renderable: ${b}`)}return a},ga=(a,b,...c)=>{a instanceof Function&&(a=a());const d=a instanceof window.Node;if(c=fa(c),d)"after"!==b&&"before"!==b||x(a)?ea(c,a,b):P.mount(a,()=>ga(a,b,...c));else if(n(a))return F(a).then(a=>ga(a,b,...c));return h(a)&&a.push(...c),2>c.length?c[0]:c},ha=(a,b=document.body||"body",c="appendChild")=>ga(b,c,a),ia={css(a,b,c){if(m(b))for(const c in b)ia.css(a,c,b[c]);else n(b)&&(0===b.indexOf("--")?a.style.setProperty(b,c):a.style[b]=c);return a},class(a,b,c){if(!a.classList)return a;if(h(a)){for(let d=0;d<a.length;d++)ia.class(a[d],b,c);return a}if(m(b))for(const c in b)ia.class(a,c,l(b[c])?b[c]:void 0);else if(n(b)&&(b=b.split(" ")),h(b)){const e=l(c);for(var d=0;d<b.length;d++)a.classList[e?c?"add":"remove":"toggle"](b[d])}return a},hasClass:B((a,b)=>a.classList.contains(b)),attr(b,c,a){if(m(c))for(const d in c){const a=i(c[d]);b[a?"removeAttribute":"setAttribute"](d,c[d]),ca(b,d,void 0,c[d],!a)}else if(n(c)){const d=b.getAttribute(c);if(i(a))return d;b.setAttribute(c,a),ca(b,c,d,a)}return b},removeAttribute(a,...b){b=C(b);for(var c=0;c<b.length;c++)a.removeAttribute(b[c]),ca(a,b[c],void 0,void 0,!1);return a},attrToggle(a,b,c=!a.hasAttribute(b),d=a.getAttribute(b)||""){return a[c?"setAttribute":"removeAttribute"](b,d),ca(a,b,c?d:null,c?null:d,c),a},emit:da,append(a,...b){return ga(a,"appendChild",...b),a},prepend(a,...b){return ga(a,"prepend",...b),a},appendTo(a,b){return ga(b,"appendChild",a),a},prependTo(a,b){return ga(b,"prepend",a),a},clear(a){return a[y(a)?"value":"textContent"]="",a},refurbish(a){return Array.from(a.attributes).forEach(({name:b})=>{a.removeAttribute(b)}),a.removeAttribute("class"),ia.clear(a)},remove(a,b){return(k(a)&&(a=a()),h(a))?a.forEach(a=>ia.remove(a,b)):(p(b)?setTimeout(()=>ia.remove(a),b):x(a)?a.remove():r(a)&&Array.from(a).forEach(a=>ia.remove(a)),a)},replace(a,b){return k(b)&&(b=b()),a.replaceWith(b),b}};ia.empty=ia.clear;const ja=K(new WeakSet),ka=K(new WeakSet),la=K(new WeakSet),ma=(a,b=!ja(a),c=g(a))=>{b&&!c&&(ja(a,!0),da(a,"create"))},na=a=>{const b=g(a);ma(a,!ja(a),b),ka(a)||(la(a)?(la(a,!1),da(a,"remount")):b?sa(a,"mount"):(ka(a,!0),da(a,"mount")))},oa=a=>{ka(a,!1),la(a,!0),da(a,"unmount")},pa=a=>sa(a,"mount")||na(a),qa=a=>sa(a,"unmount")||oa(a);new window.MutationObserver(a=>{for(let b=0;b<a.length;b++){const{addedNodes:c,removedNodes:d,attributeName:e}=a[b];if(c.length)for(let a=0;a<c.length;a++)pa(c[a]);if(d.length)for(let a=0;a<d.length;a++)qa(d[a]);"string"==typeof e&&ca(a[b].target,e,a[b].oldValue)}}).observe(document,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0});const ra=new Map,sa=(a,b,c,e)=>{if(1!==a.nodeType||!ra.has(a.tagName))return;n(b)?[c,b]=[b,ra.get(a.tagName)]:!m(b)&&(b=ra.get(a.tagName));const{create:f,mount:g,remount:h,unmount:i,props:j,methods:k,attr:l}=b,o=M(a);if(!ja(a)){if(a[d]=a.tagName,k&&T.methods(a,k),j&&T.props(a,j),e&&T.props(a,e),ja(a,!0),f&&f.call(a,o),da(a,"create"),m(l))for(const b in l)aa(a,b,l[b]);h&&Q.remount(a,h.bind(a,o))}return ka(a)||"mount"!==c?"unmount"===c&&(ka(a,!1),la(a,!0),i&&i.call(a,o),da(a,c)):la(a)?(h&&h.call(a,o),da(a,"remount")):(ka(a,!0),g&&g.call(a,o),da(a,c)),a},ta=()=>{const a={binds:new Map,bound:new Set,get(b,c){if(a.binds.has(b))return a.binds.get(b).get(c)},set(b,c,d){a.binds.has(b)||a.binds.set(b,new Map),a.bound.add(d),a.binds.get(b).set(c,d)},delete(b,c){a.binds.has(b)&&(a.bound.delete(a.binds.get(b).get(c)),a.binds.get(b).delete(c),!a.binds.get(b).size&&a.binds.delete(b))},update(){a.bound.forEach(a=>a())},clear(){a.bound.forEach(a=>a.revoke()),a.bound.clear(),a.binds.forEach(a=>a.clear()),a.clear()}};return a};a.isArr=h,a.isComponent=g,a.isNil=i,a.isDef=j,a.isObj=m,a.isFunc=k,a.isBool=l,a.isStr=n,a.isNum=p,a.isArrlike=q,a.isNodeList=r,a.isNode=s,a.isModel=e,a.isMounted=x,a.isPrimitive=t,a.isPromise=v,a.isProxyNode=f,a.isRenderable=z,a.isRegExp=w,a.isInt=o,a.isInput=y,a.isEmpty=a=>i(a)||!((m(a)?Object.keys(a):a).length||a.size),a.isEl=u,a.isSvg=a=>(f(a)&&(a=a()),a instanceof window.SVGElement),a.allare=A,a.attributeObserver=aa,a.flatten=C,a.curry=B,a.compose=(...a)=>a.reduce((c,a)=>(...b)=>c(a(...b))),a.components=ra,a.component=(a,b)=>{if(-1===a.indexOf("-"))throw new Error(`component: ${a} tagName is un-hyphenated`);return ra.set(a.toUpperCase(),b),D(()=>H(a,sa)),Z[a]},a.run=D,a.render=ha,a.runAsync=(a,...b)=>setTimeout(a,0,...b),a.query=E,a.queryAsync=F,a.queryAll=G,a.queryEach=H,a.on=Q,a.once=P,a.emitter=(a={},b=new Map)=>Object.assign(a,{listeners:b,emit:J((a,...c)=>{if(b.has(a))for(const d of b.get(a))d.apply(void 0,c)}),emitAsync:J((a,...c)=>setTimeout(()=>{if(b.has(a))for(const d of b.get(a))setTimeout(d,0,...c)},0),!1),on:J((c,d)=>{b.has(c)||b.set(c,new Set),b.get(c).add(d);const e=()=>a.off(c,d);return e.off=e,e.on=()=>(e(),a.on(c,d)),e.once=()=>(e(),a.once(c,d)),e}),once:J((b,c)=>a.on(b,function d(){c(...arguments),a.off(b,d)})),off:J((a,c)=>{if(b.has(a)){const d=b.get(a);d.delete(c),d.size||b.delete(a)}})}),a.each=I,a.svg=Y,a.fastdom=V,a.dom=Z,a.domfn=ia,a.html=R,a.directive=(a,{init:b,update:c,remove:d,accessors:e,toggle:f})=>{const g=new Map;g.init=e=>{_(a,e)||g.set(e,aa(e,a,{init:b,update:c,remove:d}))},g.stop=a=>{g.has(a)&&g.get(a)()},ba.set(a,g),D(()=>{H("["+a+"]",b=>{ca(b,a)})})},a.directives=ba,a.prime=fa,a.state=({val:a,pre:b,prescreen:c,screen:d,pass:e,fail:f,views:g,binds:i,revoked:j})=>{const l=ta();let o=!1;const p=(b,c,d,e)=>{const f=n(d);if(f&&!(d in q))throw new Error("state.bind: cannot create bind to undefined view");let g;return g=k(c)?f?()=>c(b,q[d]):()=>c(b,a):f?()=>{b[c]=q[d]}:()=>{b[c]=a},g.revoke=()=>{l.delete(b,c),e()},l.set(b,c,g),g};p.input=b=>{const c=()=>{b.value=a},d=()=>{s(b.value.trim())};return b.addEventListener("input",d),c.revoke=()=>{b.removeEventListener("input",d),l.delete(b,"value")},c.reinstate=()=>{c.revoke(),l.set(b,"value",c),b.addEventListener("input",d)},l.set(b,"value",c),c};const q=()=>a,r=(b,c)=>{if(!k(c))throw new TypeError("a view should be a function");Object.defineProperty(q,b,{get:()=>c(a)})};if(m(g))for(const a in g)r(a,g[a]);if(h(i)&&(i.forEach(a=>{h(a)?p(...a):m(a)&&p(a.host,a.prop,a.viewName)}),l.update()),void 0!==d&&w(d)){const a=d;d=b=>n(b)&&a.test(b)}const s=g=>{if(!(o||g===a)){if(k(g)&&(g=g(a)),void 0===g)throw new Error("state.mutate: cannot create mutation from undefined");else if(k(g))throw new TypeError("state: cannot accept function values");return v(g)?g.then(a=>s(a),a=>f(g,a)):void(b&&(c||!c(g,a)?f(g,new Error("failed prescreen")):g=b(g,a)),d&&!d(g,a)?f&&f(g,new Error("failed screening")):(a=g,l.update(),e&&e(a)))}},t={bind:p,view:q,createView:r,mutate:s,binds:l,revoke(){l.clear(),o=!0,j()}};return Object.freeze(t)},a.Mounted=ka,a.Unmounted=la,a.Created=ja,a.$=M,Object.defineProperty(a,"__esModule",{value:!0})});