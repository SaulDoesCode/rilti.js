(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.rilti={})})(this,function(a){"use strict";const b=Symbol("Proxy Node"),c=Symbol("Component"),d=a=>i(a)&&!0===a[b],e=a=>a!==void 0&&a[c]!==void 0,f=Array.isArray,g=a=>a===void 0||null===a,h=a=>a!==void 0&&null!==a,i=a=>a instanceof Function,j=a=>"boolean"==typeof a,k=a=>"object"==typeof a&&a.constructor===Object,l=a=>"string"==typeof a,m=a=>"number"==typeof a&&!isNaN(a),n=a=>m(a)&&0==a%1,o=a=>f(a)||a instanceof window.NodeList||h(a)&&!(i(a)||q(a))&&0==a.length%1,p=(a,b=!0)=>a instanceof window.NodeList||b&&w(a,q),q=a=>a instanceof window.Node,r=a=>(a=typeof a,"string"===a||"number"===a||"boolean"===a),s=a=>a instanceof window.Element,t=(a,b=document)=>p(a)?Array.from(a).every(a=>t(a)):b===a||!!(16&b.compareDocumentPosition(a)),u=a=>(d(a)&&(a=a()),a instanceof window.HTMLInputElement||a instanceof window.HTMLTextAreaElement),v=a=>a instanceof window.Node||d(a)||r(a)||w(a,v),w=(a,b)=>{if(o(a)){const c=b instanceof Function;for(let d=0;d<a.length;d++)if(c?!b(a[d]):a[d]!==b)return!1;return!0}return!1},x=(a,b=a.length,...c)=>b<=c.length?a(...c):x.bind(void 0,a,b,...c),y=(a,b=[],c=!0)=>{if(c&&!f(a))return[a];for(let d=0;d<a.length;d++)f(a[d])?y(a[d],b):b.push(a[d]);return b},z=(a,...b)=>{window.requestIdleCallback?window.requestIdleCallback(a.bind(void 0,...b)):setTimeout(a,0,...b)},A=(...a)=>{document.body||"complete"===document.readyState?z.apply(void 0,a):window.addEventListener("DOMContentLoaded",()=>z.apply(void 0,a))},B=(a,b=document)=>q(a)?a:B(b).querySelector(a),C=(a,b)=>new Promise((c,d)=>{const e=()=>{const e=B(a,b);g(e)?d(new Error(`queryAsync: couldn't find ${a}`)):c(e)};document.body?e():A(e)}),D=(a,b=document)=>Array.from(B(b).querySelectorAll(a)),E=(a,b,c=document)=>(i(b)||([b,c]=[c,document]),F(D(a,c),b)),F=(a,b)=>{if(h(a))if(k(a))for(const c in a)b(a[c],c,a);else if(a.length){const c=a.length;for(let d=0;d!==c;)b(a[d],d++,a)}else if(a.forEach)a.forEach(b);else if(n(a))for(let c=0;c<a;)b(c++,a);return a},G=(a,b=!1)=>new Proxy(a,{get:(a,c)=>b&&c in a?Reflect.get(a,c):a.bind(void 0,c)}),H=a=>(b,c)=>a[c===void 0?"has":c?"add":"delete"](b),I=new Map,J=a=>{if(d(a))return a;if("string"==typeof a&&(a=B(a)),I.has(a))return I.get(a);if(!q(a))throw new TypeError(`$ needs a Node: ${a}`);const c=new Proxy((...b)=>(ea.class(a,...b),o),{get:(b,c)=>a.classList.contains(c),set:(a,b,c)=>a(b,c),deleteProperty:(b,c)=>!!a.classList.remove(c)});if(s(a))var e=a.getAttribute.bind(a),f=a.hasAttribute.bind(a),g=ea.removeAttribute.bind(void 0,a),h=new Proxy((b,c)=>{const d=ea.attr(a,b,c);return d===a?o:d},{get(a,b){return"has"===b?f:"remove"===b||"rm"===b?g:e(b)},set(a,b,c){return"remove"===b?g(c):a(b,c),!0},deleteProperty:(b,c)=>ea.removeAttribute(a,c)});const j=u(a)?"value":"textContent",k=u(a)?"value":3===a.nodeType?j:"innerHTML",m=G(K(!0,a),!1),n=G(K(!1,a),!1),o=new Proxy(b=>(i(b)&&!d(b)&&b.call(a,o,a),a),{get(e,f){return"class"===f?c:"attr"===f?h:"txt"===f?a[j]:"html"===f?a[k]:"on"===f?n:"once"===f?m:"emit"===f?aa.bind(void 0,a):"mounted"===f?t(a):"render"===f?da.bind(a,a):"children"===f?Array.from(a.children):"$children"===f?Array.from(a.children).map(J):"parent"===f&&a.parentNode?J(a.parentNode):f in ea?(...b)=>{const c=ea[f](a,...b);return c===a||c===o?o:c}:f===b||(i(a[f])&&!d(a[f])?a[f].bind(a):a[f])},set(b,d,e){return"class"===d?c(a,e):"attr"===d?h(a,e):"css"===d?ea.css(a,e):"txt"===d?a[j]=e:"html"===d||"children"===d?l(e)?a[k]=e:(a[j]="",ba(ca(e),a)):a[d]=e,!0}});return I.set(a,o),o},K=x((a,b,c,d,e=!1)=>{if(l(b)&&(b=B(b)),k(c)){for(const d in c)c[d]=K(a,b,d,c[d],e);return c}if(!i(d))return K.bind(void 0,a,b,c);d=d.bind(b);const f=s(b)?J(b):b,g=b=>{d(b,f),a&&h()},h=()=>(b.removeEventListener(c,g),m),j=d=>(a=!!d,b.addEventListener(c,g,e),m),m={handler:g,on:j,off:h,once:j.bind(void 0,!0),emit(a,c){return b.dispatchEvent(new window.CustomEvent(a,{detail:c})),m}};return j(a)},3),L={get:(a,b)=>(c,d,e)=>a(c,b,d,e)},M=new Proxy(K(!0),L),N=new Proxy(K(!1),L),O=(a,b)=>(a instanceof Function&&(a=a(b)),"string"==typeof a)?Array.from(document.createRange().createContextualFragment(a).childNodes):a instanceof window.Node?a:f(a)?a.map(a=>O(a)):void 0,P=a=>a===void 0?document.createDocumentFragment():O(a),Q={props(a,b){const c=J(a);for(const e in b){let f=b[e];if(e in a)a[e]=f;else if("accessors"==e)for(const b in f){const{set:d=f[b],get:e=f[b]}=f[b],g={};i(d)&&(g.set=d.bind(a,c)),i(e)&&(g.get=e.bind(a,c)),Object.defineProperty(a,b,g)}else i(f)&&!d(f)?a[e]=f.call(a,c):Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(b,e))}},methods(a,b){const c=J(a);for(const d in b)Object.defineProperty(a,d,{value:b[d].bind(a,c)})}},R=(a,b)=>b in a?Reflect.get(a,b):new Proxy(a.bind(void 0,b),{get(a,b){const c=[b.replace(/_/g,"-")];return new Proxy((...b)=>(a=a(...b),ea.class(a(),c),a),{get(a,b,d){return c.push(b.replace(/_/g,"-")),d}})}}),S=["$","id","render","children","html","class","className"],T=(a,b,...c)=>{const d=document.createElementNS("http://www.w3.org/2000/svg",a);if(k(b))for(const a in b)r(b[a])&&-1===S.indexOf(a)&&!(a in ea)&&(d.setAttribute(a,b[a]),b[a]=void 0);return V(d,b,...c)},U=new Proxy(T.bind(void 0,"svg"),{get:(a,b)=>R(T,b)}),V=new Proxy(Object.assign((a,b,...c)=>{const e="string"==typeof a?document.createElement(a):a,g=na.has(e.tagName);if(g)var h;const j=J(e);if(k(b)){var l=b.pure;for(const a in!g&&b.props&&Q.props(e,b.props),b.methods&&Q.methods(e,b.methods),b.sync&&(b.sync=b.sync(e)),b){let c=b[a];const d=0===a.indexOf("once"),g=!d&&0===a.indexOf("on");if(d||g){const g=d?4:2,h=a.substr(0,g);let i=a.substr(g);const j=K(d),k=f(c)?c:[c];b[h]||(b[h]={}),b[h][i]=i.length?j(e,i,...k):j(e,...k)}else a in e?i(e[a])?f(c)?e[a].apply(e,c):e[a](c):e[a]=b[a]:a in ea&&(c=f(b[a])?ea[a](e,...c):ea[a](e,c),c!==e&&(b[a]=c))}if(b.cycle){const{mount:a,create:c,remount:d,unmount:f}=b.cycle;c&&M.create(e,c.bind(e,j)),a&&M.mount(e,a.bind(e,j)),b.cycle.unmount=f&&N.unmount(e,f.bind(e,j)),b.cycle.remount=d&&N.remount(e,d.bind(e,j))}g&&(oa(e,void 0,void 0,b.props),h=!0);const a=b.$||b.render;a?_(a,"appendChild",e):b.renderAfter?_(b.renderAfter,"after",e):b.renderBefore&&_(b.renderBefore,"before",e)}if(3!==e.nodeType){if(d(b)&&b!==j)c.unshift(b(j));else if(b instanceof Function){const a=b.call(e,j);b=a!==e&&a!==j?a:void 0}v(b)&&c.unshift(b),c.length&&_(e,"appendChild",...c)}return g?!h&&oa(e,void 0):ia(e,!0,g),l?e:j},{text:(a,b="")=>(r(a)&&([b,a]=[a,void 0]),V(new window.Text(b),a)),body:(...a)=>(_(document.body||"body","appendChild",...a),1<a.length?a:a[0]),svg:U,frag:P,html:O}),{get:R}),W=new Map,X=(a,b)=>W.has(a)&&W.get(a)(b),Y=(a,b,c)=>{a=J(a);const{init:d,update:e,remove:f}=c,g=(c,e)=>c&&!X(b,a)?(d&&d(a,e),W.has(b)||W.set(b,H(new WeakSet)),W.get(b)(a,!0),!0):X(b,a);let h=!1,i=a.getAttribute(b);g(a.hasAttribute(b),i);const j=a.on.attr(({detail:{name:c,value:d,oldvalue:j,present:k}})=>{b===c&&i!==d&&d!==j&&g(k,d)&&(k?(e&&e(a,d,i),h=!1):!h&&(f&&f(a,d,i),h=!0),i=d)}).off;return()=>{j(),W.has(b)&&W.get(b)(a,!1)}},Z=new Map,$=(a,b,c,d=a.getAttribute(b),e=a.hasAttribute(b))=>{Z.has(b)&&Z.get(b).init(J(a)),aa(a,"attr",{name:b,value:d,oldvalue:c,present:e})},aa=(a,b,c)=>(a.dispatchEvent(new window.CustomEvent(b,{detail:c})),a),ba=(a,b,c="appendChild",d=P(),e)=>{for(let g,h=0;h<a.length;h++){if(g=a[h],g instanceof Function)if((g=g(b))===b)continue;else if(g instanceof Function){let a=0,c=!1;for(;g instanceof Function&&25>a&&(g=g(),!(c=g===b));)a++;if(c)continue}if("string"==typeof g){if(!g.length)continue;g=new window.Text(g)}else f(g)&&(g=ba(g,b,c,d,!0));g instanceof window.Node&&(d.appendChild(g),a[h]=g)}return b&&!e&&A(()=>{b[c](d);for(let b=0;b<a.length;b++)a[b]&&a[b].dispatchEvent&&ja(a[b])}),a},ca=(...a)=>{for(let b,c=0;c<a.length;c++){if(b=a[c],b instanceof window.Node||b instanceof Function)continue;else if(r(b)){a[c]=new window.Text(b);continue}const d=b instanceof window.NodeList;if(d){if(2>b.length){a[c]=b[0];continue}b=Array.from(b)}else k(b)&&(b=Object.values(b));if(f(b)){if(!d&&(b=ca.apply(void 0,b),2>b.length)){a[c]=b[0];continue}const e=b.length;b.unshift(c,1),a.splice.apply(a,b),b.slice(2,0),c+=e}else if(h(b))throw new Error(`illegal renderable: ${b}`)}return a},_=(a,b,...c)=>{a instanceof Function&&(a=a());const d=a instanceof window.Node;if(c=ca(c),d)"after"!==b&&"before"!==b||t(a)?ba(c,a,b):M.mount(a,()=>_(a,b,...c));else if(l(a))return C(a).then(a=>_(a,b,...c));return f(a)&&a.push(...c),2>c.length?c[0]:c},da=(a,b=document.body||"body",c="appendChild")=>_(b,c,a),ea={css(a,b,c){if(k(b))for(const c in b)ea.css(a,c,b[c]);else l(b)&&(0===b.indexOf("--")?a.style.setProperty(b,c):a.style[b]=c);return a},class(a,b,c){if(!a.classList)return a;if(f(a)){for(let d=0;d<a.length;d++)ea.class(a[d],b,c);return a}if(k(b))for(const c in b)ea.class(a,c,j(b[c])?b[c]:void 0);else if(l(b)&&(b=b.split(" ")),f(b)){const e=j(c);for(var d=0;d<b.length;d++)a.classList[e?c?"add":"remove":"toggle"](b[d])}return a},hasClass:x((a,b)=>a.classList.contains(b)),attr(b,c,a){if(k(c))for(const d in c){const a=g(c[d]);b[a?"removeAttribute":"setAttribute"](d,c[d]),$(b,d,void 0,c[d],!a)}else if(l(c)){const d=b.getAttribute(c);if(g(a))return d;b.setAttribute(c,a),$(b,c,d,a)}return b},removeAttribute(a,...b){b=y(b);for(var c=0;c<b.length;c++)a.removeAttribute(b[c]),$(a,b[c],void 0,void 0,!1);return a},attrToggle(a,b,c=!a.hasAttribute(b),d=a.getAttribute(b)||""){return a[c?"setAttribute":"removeAttribute"](b,d),$(a,b,c?d:null,c?null:d,c),a},emit:aa,append(a,...b){return _(a,"appendChild",...b),a},prepend(a,...b){return _(a,"prepend",...b),a},appendTo(a,b){return _(b,"appendChild",a),a},prependTo(a,b){return _(b,"prepend",a),a},clear(a){return a[u(a)?"value":"textContent"]="",a},refurbish(a){return Array.from(a.attributes).forEach(({name:b})=>{a.removeAttribute(b)}),a.removeAttribute("class"),ea.clear(a)},remove(a,b){return(i(a)&&(a=a()),f(a))?a.forEach(a=>ea.remove(a,b)):(m(b)?setTimeout(()=>ea.remove(a),b):t(a)?A(()=>a.remove()):p(a)&&Array.from(a).forEach(a=>ea.remove(a)),a)},replace(a,b){return i(b)&&(b=b()),A(()=>a.replaceWith(b)),b}};ea.empty=ea.clear;const fa=H(new WeakSet),ga=H(new WeakSet),ha=H(new WeakSet),ia=(a,b=!fa(a),c=e(a))=>{b&&!c&&(fa(a,!0),aa(a,"create"))},ja=a=>{const b=e(a);ia(a,!fa(a),b),ga(a)||(ha(a)?(ha(a,!1),aa(a,"remount")):b?oa(a,"mount"):(ga(a,!0),aa(a,"mount")))},ka=a=>{ga(a,!1),ha(a,!0),aa(a,"unmount")},la=a=>oa(a,"mount")||ja(a),ma=a=>oa(a,"unmount")||ka(a);new window.MutationObserver(a=>{for(let b=0;b<a.length;b++){const{addedNodes:c,removedNodes:d,attributeName:e}=a[b];if(c.length)for(let a=0;a<c.length;a++)la(c[a]);if(d.length)for(let a=0;a<d.length;a++)ma(d[a]);"string"==typeof e&&$(a[b].target,e,a[b].oldValue)}}).observe(document,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0});const na=new Map,oa=(a,b,d,e)=>{if(1!==a.nodeType||!na.has(a.tagName))return;l(b)?[d,b]=[b,na.get(a.tagName)]:!k(b)&&(b=na.get(a.tagName));const{create:f,mount:g,remount:h,unmount:i,props:j,methods:m,attr:n}=b,o=J(a);if(!fa(a)){if(a[c]=a.tagName,m&&Q.methods(a,m),j&&Q.props(a,j),e&&Q.props(a,e),fa(a,!0),f&&f.call(a,o),aa(a,"create"),k(n))for(const b in n)Y(a,b,n[b]);h&&N.remount(a,h.bind(a,o))}return ga(a)||"mount"!==d?"unmount"===d&&(ga(a,!1),ha(a,!0),i&&i.call(a,o),aa(a,d)):ha(a)?(h&&h.call(a,o),aa(a,"remount")):(ga(a,!0),g&&g.call(a,o),aa(a,d)),a};a.isArr=f,a.isComponent=e,a.isNil=g,a.isDef=h,a.isObj=k,a.isFunc=i,a.isBool=j,a.isStr=l,a.isNum=m,a.isArrlike=o,a.isNodeList=p,a.isNode=q,a.isMounted=t,a.isPrimitive=r,a.isPromise=a=>"object"==typeof a&&i(a.then),a.isProxyNode=d,a.isRenderable=v,a.isRegExp=a=>a instanceof RegExp,a.isInt=n,a.isInput=u,a.isEmpty=a=>g(a)||!((k(a)?Object.keys(a):a).length||a.size),a.isEl=s,a.isSvg=a=>(d(a)&&(a=a()),a instanceof window.SVGElement),a.allare=w,a.attributeObserver=Y,a.flatten=y,a.curry=x,a.compose=(...a)=>a.reduce((c,a)=>(...b)=>c(a(...b))),a.components=na,a.component=(a,b)=>{if(-1===a.indexOf("-"))throw new Error(`component: ${a} tagName is un-hyphenated`);return na.set(a.toUpperCase(),b),A(E,a,oa),V[a]},a.run=A,a.render=da,a.runAsync=z,a.query=B,a.queryAsync=C,a.queryAll=D,a.queryEach=E,a.on=N,a.once=M,a.each=F,a.svg=U,a.dom=V,a.domfn=ea,a.html=O,a.directive=(a,{init:b,update:c,remove:d,accessors:e,toggle:f})=>{const g=new Map;g.init=e=>{X(a,e)||g.set(e,Y(e,a,{init:b,update:c,remove:d}))},g.stop=a=>{g.has(a)&&g.get(a)()},Z.set(a,g),A(()=>{E("["+a+"]",b=>{$(b,a)})})},a.directives=Z,a.prime=ca,a.Mounted=ga,a.Unmounted=ha,a.Created=fa,a.$=J,Object.defineProperty(a,"__esModule",{value:!0})});