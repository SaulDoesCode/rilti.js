{const{isObj:a,isArr:b,model:c,emitter:d,each:e}=rilti;rilti.ws=(b,c={})=>{const f=d(),e=new WebSocket(b);return e.onopen=()=>{f.emit.open(f.isOpen=1===e.readyState)},e.onmessage=(a)=>{try{const b=JSON.parse(a.data);f.emit.msg(b,a)}catch(b){c.silent||console.warn(`rilti.ws: couldn't decode json message`),f.emit.msg(a.data,a)}},e.onerror=f.emit.err,e.onclose=f.emit.close,c.defaults||(c.defaults={}),Object.assign({ws:e,close(){e.close()},set defaults(b){if(a(b))c.defaults=Object.assign(b,c.defaults);else throw new TypeError('rilti.ws: setDefaults only takes an Object')},get defaults(){return c.defaults},send(b){try{a(b)&&(b=JSON.stringify(Object.assign(b,c.defaults))),1===e.readyState?e.send(b):f.once.open(()=>e.send(b))}catch(a){c.silent||console.error(a)}}},f)},rilti.arrayBufferToB64=(a)=>{let c='';return new Uint8Array(a).forEach((a)=>{c+=String.fromCharCode(a)}),btoa(c)},rilti.cache=(c)=>{const f=d(localforage.createInstance({name:c}));f.delete=(a)=>new Promise((b,c)=>{f.removeItem(a,(d)=>d?(f.emit.error(a,d),c(new Error(' an error occured while attempting to delete '+a))):void(b(a+' deleted'),f.emit['delete:'+a]()))});let g=!1;f.ready((a)=>{if(a)throw a;f.emit.ready(g=!0)});const h=new Proxy((a)=>a&&e(a,(a,b)=>{h[b]=a}),{set(a,b,c){return g?(f.setItem(b,c,(a)=>a?f.emit.error(b,a):void f.emit('set:'+b,c)),!0):f.once.ready(()=>{h[b]=c})},get:(a,b)=>Reflect.has(f,b)?Reflect.get(f,b):new Promise((a,c)=>{const d=()=>{f.getItem(b,(d,e)=>d?(c(d),f.emit.error(b,d)):void(a(e),f.emit('get:'+b)))};g?d():f.once.ready(d)})});return f.resource=(a,b='text',c)=>new Promise((d,e)=>h[a].then((f)=>f?d(f):void fetch(a,c||{method:'GET',mode:'cors'}).then((c)=>{d(h[a]=c[b]())},e),e)),f.local=new Proxy(Object.assign((c,d)=>{if(a(c))e(c,(a,b)=>f.local(b,a));else if(void 0!==d){const e=a(d)||b(d);localStorage.setItem(c,e?JSON.stringify(d):d),e&&localStorage.setItem('isJSON:'+c,!0)}else return localStorage.getItem('isJSON:'+c)?JSON.parse(localStorage.getItem(c)):localStorage.getItem(c)},{clear(){localStorage.clear()},remove(...a){e(a,(a)=>{localStorage.removeItem(a),localStorage.removeItem('isJSON:'+a)})}}),{get(a,b){return b in a?a[b]:a(b)},set(a,b,c){return a(b,c)}}),h},rilti.apps={};const f={cache:!0};rilti.app=(a,b={},d={})=>{if(a in rilti.apps)return rilti.apps[a];b=Object.assign(b,f,!0);const g=c(d);return b.cache&&(g.cache=rilti.cache(a)),g.eventEmit=(a,b)=>(c,d)=>{g.emit(a,b(d,c))},rilti.apps[a]=g,(a)=>a(g,g.cache,g.cache.local)}}