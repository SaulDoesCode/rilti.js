{const{isObj:a,isStr:b,isFunc:c,isArr:d,model:e,notifier:f,extend:g,each:h}=rilti;rilti.ws=(b,c={})=>{const d=f(),e=new WebSocket(b);return e.onopen=()=>{d.emit.open(d.isOpen=1===e.readyState)},e.onmessage=(a)=>{try{const b=JSON.parse(a.data);d.emit.msg(b,a)}catch(b){c.silent||console.warn(`rilti.ws: couldn't decode json message`),d.emit.msg(a.data,a)}},e.onerror=d.emit.err,e.onclose=d.emit.close,c.defaults||(c.defaults={}),g(d,{ws:e,close(){e.close()},set defaults(b){if(a(b))c.defaults=Object.assign(b,c.defaults);else throw new TypeError('rilti.ws: setDefaults only takes an Object')},get defaults(){return c.defaults},send(b){try{a(b)&&(b=JSON.stringify(Object.assign(b,c.defaults))),1===e.readyState?e.send(b):d.once.open(()=>e.send(b))}catch(a){c.silent||console.error(a)}}})},rilti.arrayBufferToB64=(a)=>{let c='';return new Uint8Array(a).forEach((a)=>{c+=String.fromCharCode(a)}),btoa(c)},rilti.cache=(b)=>{const c=f(localforage.createInstance({name:b}));c.delete=(a)=>new Promise((b,d)=>{c.removeItem(a,(e)=>e?(c.emit.error(a,e),d(' an error occured while attempting to delete '+a)):void(b(a+' deleted'),c.emit['delete:'+a]()))});let e=!1;c.ready((a)=>{if(a)throw a;c.emit.ready(e=!0)});const i=new Proxy((a)=>a&&h(a,(a,b)=>i[b]=a),{set(a,b,d){return e?(c.setItem(b,d,(a)=>a?c.emit.error(b,a):void c.emit('set:'+b,d)),!0):c.once.ready(()=>i[b]=d)},get:(a,b)=>Reflect.has(c,b)?Reflect.get(c,b):new Promise((a,d)=>{const f=()=>{c.getItem(b,(e,f)=>e?(d(e),c.emit.error(b,e)):void(a(f),c.emit('get:'+b)))};e?f():c.once.ready(f)})});return c.resource=(a,b='text',c)=>new Promise((d,e)=>i[a].then((f)=>f?d(f):void fetch(a,c||{method:'GET',mode:'cors'}).then((c)=>{d(i[a]=c[b]())},e),e)),c.local=new Proxy(g((b,e)=>{if(a(b))h(b,(a,b)=>c.local(b,a));else if(void 0!==e){const c=a(e)||d(e);localStorage.setItem(b,c?JSON.stringify(e):e),c&&localStorage.setItem('isJSON:'+b,!0)}else return localStorage.getItem('isJSON:'+b)?JSON.parse(localStorage.getItem(b)):localStorage.getItem(b)},{clear(){localStorage.clear()},remove(...a){h(a,(a)=>{localStorage.removeItem(a),localStorage.removeItem('isJSON:'+a)})}}),{get(a,b){return b in a?a[b]:a(b)},set(a,b,c){return a(b,c)}}),i},rilti.apps={};const i={cache:!0};rilti.app=(a,b={},c={})=>{if(a in rilti.apps)return rilti.apps[a];b=g(b,i,!0);const d=e(c);return b.cache&&(d.cache=rilti.cache(a)),d.eventEmit=(a,b)=>(c,e)=>{d.emit(a,b(e,c))},rilti.apps[a]=d,(a)=>a(d,d.cache,d.cache.local)}}