{const{isObj:a,isArr:b,model:c,notifier:d,extend:e,each:f}=rilti;rilti.ws=(b,c={})=>{const f=d(),g=new WebSocket(b);return g.onopen=()=>{f.emit.open(f.isOpen=1===g.readyState)},g.onmessage=(a)=>{try{const b=JSON.parse(a.data);f.emit.msg(b,a)}catch(b){c.silent||console.warn(`rilti.ws: couldn't decode json message`),f.emit.msg(a.data,a)}},g.onerror=f.emit.err,g.onclose=f.emit.close,c.defaults||(c.defaults={}),e(f,{ws:g,close(){g.close()},set defaults(b){if(a(b))c.defaults=Object.assign(b,c.defaults);else throw new TypeError('rilti.ws: setDefaults only takes an Object')},get defaults(){return c.defaults},send(b){try{a(b)&&(b=JSON.stringify(Object.assign(b,c.defaults))),1===g.readyState?g.send(b):f.once.open(()=>g.send(b))}catch(a){c.silent||console.error(a)}}})},rilti.arrayBufferToB64=(a)=>{let c='';return new Uint8Array(a).forEach((a)=>{c+=String.fromCharCode(a)}),btoa(c)},rilti.cache=(c)=>{const g=d(localforage.createInstance({name:c}));g.delete=(a)=>new Promise((b,c)=>{g.removeItem(a,(d)=>d?(g.emit.error(a,d),c(new Error(' an error occured while attempting to delete '+a))):void(b(a+' deleted'),g.emit['delete:'+a]()))});let h=!1;g.ready((a)=>{if(a)throw a;g.emit.ready(h=!0)});const i=new Proxy((a)=>a&&f(a,(a,b)=>{i[b]=a}),{set(a,b,c){return h?(g.setItem(b,c,(a)=>a?g.emit.error(b,a):void g.emit('set:'+b,c)),!0):g.once.ready(()=>{i[b]=c})},get:(a,b)=>Reflect.has(g,b)?Reflect.get(g,b):new Promise((a,c)=>{const d=()=>{g.getItem(b,(d,e)=>d?(c(d),g.emit.error(b,d)):void(a(e),g.emit('get:'+b)))};h?d():g.once.ready(d)})});return g.resource=(a,b='text',c)=>new Promise((d,e)=>i[a].then((f)=>f?d(f):void fetch(a,c||{method:'GET',mode:'cors'}).then((c)=>{d(i[a]=c[b]())},e),e)),g.local=new Proxy(e((c,d)=>{if(a(c))f(c,(a,b)=>g.local(b,a));else if(void 0!==d){const e=a(d)||b(d);localStorage.setItem(c,e?JSON.stringify(d):d),e&&localStorage.setItem('isJSON:'+c,!0)}else return localStorage.getItem('isJSON:'+c)?JSON.parse(localStorage.getItem(c)):localStorage.getItem(c)},{clear(){localStorage.clear()},remove(...a){f(a,(a)=>{localStorage.removeItem(a),localStorage.removeItem('isJSON:'+a)})}}),{get(a,b){return b in a?a[b]:a(b)},set(a,b,c){return a(b,c)}}),i},rilti.apps={};const g={cache:!0};rilti.app=(a,b={},d={})=>{if(a in rilti.apps)return rilti.apps[a];b=e(b,g,!0);const f=c(d);return b.cache&&(f.cache=rilti.cache(a)),f.eventEmit=(a,b)=>(c,d)=>{f.emit(a,b(d,c))},rilti.apps[a]=f,(a)=>a(f,f.cache,f.cache.local)}}